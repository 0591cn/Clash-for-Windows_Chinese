(()=>{var e={228:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0},858:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0},646:(e,t,n)=>{var r=n(228);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.default=e.exports,e.exports.__esModule=!0},926:e=>{function t(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(o,i){var a=e.apply(n,r);function c(e){t(a,o,i,c,s,"next",e)}function s(e){t(a,o,i,c,s,"throw",e)}c(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},713:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0},860:e=>{e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0},884:e=>{e.exports=function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}},e.exports.default=e.exports,e.exports.__esModule=!0},521:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},206:e=>{e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},38:(e,t,n)=>{var r=n(858),o=n(884),i=n(379),a=n(521);e.exports=function(e,t){return r(e)||o(e,t)||i(e,t)||a()},e.exports.default=e.exports,e.exports.__esModule=!0},319:(e,t,n)=>{var r=n(646),o=n(860),i=n(379),a=n(206);e.exports=function(e){return r(e)||o(e)||i(e)||a()},e.exports.default=e.exports,e.exports.__esModule=!0},379:(e,t,n)=>{var r=n(228);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},757:(e,t,n)=>{e.exports=n(666)},666:e=>{var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),a=new P(r||[]);return i._invoke=function(e,t,n){var r=p;return function(o,i){if(r===f)throw new Error("Generator is already running");if(r===h){if("throw"===o)throw i;return T()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=_(a,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===p)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var s=u(e,t,n);if("normal"===s.type){if(r=n.done?h:d,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=h,n.method="throw",n.arg=s.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p="suspendedStart",d="suspendedYield",f="executing",h="completed",m={};function b(){}function g(){}function y(){}var w={};w[i]=function(){return this};var v=Object.getPrototypeOf,x=v&&v(v(I([])));x&&x!==n&&r.call(x,i)&&(w=x);var k=y.prototype=b.prototype=Object.create(w);function C(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function n(o,i,a,c){var s=u(e[o],e,i);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==typeof p&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(p).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,c)}))}c(s.arg)}var o;this._invoke=function(e,r){function i(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(i,i):i()}}function _(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=u(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function I(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:T}}function T(){return{value:t,done:!0}}return g.prototype=k.constructor=y,y.constructor=g,g.displayName=s(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s(e,c,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},C(M.prototype),M.prototype[a]=function(){return this},e.AsyncIterator=M,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new M(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(k),s(k,c,"Generator"),k[i]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:I(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}},354:e=>{"use strict";e.exports=require("@fndroid/network-interface")},113:e=>{"use strict";e.exports=require("electron-window-bounds")},948:e=>{"use strict";e.exports=require("fix-path")},793:e=>{"use strict";e.exports=require("lodash")},298:e=>{"use strict";e.exports=require("electron")},147:e=>{"use strict";e.exports=require("fs")},17:e=>{"use strict";e.exports=require("path")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r);var e=n(319),t=n.n(e),o=n(38),i=n.n(o),a=n(713),c=n.n(a),s=n(926),l=n.n(s),u=n(757),p=n.n(u);require("@vue/reactivity");const d=require("axios");var f=n.n(d),h=n(298);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){c()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g,y,w,v,x,k=n(298).TouchBar,C=k.TouchBarButton,M=n(17),_=n(147),S=n(793),O=n(948);global.__static=n(17).join(__dirname,"/static").replace(/\\/g,"\\\\"),O(),h.app.disableHardwareAcceleration(),h.app.commandLine.appendSwitch("disable-features","OutOfBlinkCors"),"darwin"===process.platform&&h.app.dock.hide();var P,I=[],T="file://".concat(__dirname,"/index.html");function j(){return"linux"===process.platform}function L(){g&&("win32"===process.platform?g.isMinimized()?g.restore():g.show():(g.setVisibleOnAllWorkspaces(!0),setTimeout((function(){g.show(),g.setVisibleOnAllWorkspaces(!1)}),1)))}function D(){var e,r;(g=new h.BrowserWindow({height:603,width:850,minWidth:850,minHeight:603,backgroundColor:h.nativeTheme.shouldUseDarkColors?"#272531":"#f5f5f5",useContentSize:!0,show:!1,minimizable:!0,frame:!1,titleBarStyle:"hidden",icon:j()?M.join(__static,"imgs","icon_512.png"):void 0,webPreferences:{nodeIntegration:!0,webSecurity:!0,nodeIntegrationInWorker:!1,contextIsolation:!1,preload:M.resolve(M.join(__dirname,"preload.js"))}})).setMenu(null),g.webContents.on("will-navigate",(function(e){return e.preventDefault()})),g.loadURL(T,{userAgent:"ClashforWindows/".concat(h.app.getVersion())}),g.webContents.on("render-process-gone",(e=l()(p().mark((function e(t,n){var r,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.reason,"darwin"!==process.platform){e.next=3;break}return e.abrupt("return");case 3:if("crashed"!==r){e.next=10;break}return o={type:"error",title:"Clash for Windows",message:"仪表板崩溃了!",buttons:["Reload","Exit"]},e.next=7,h.dialog.showMessageBox(g,o);case 7:0===e.sent.response?A():h.app.quit();case 10:case"end":return e.stop()}}),e)}))),function(t,n){return e.apply(this,arguments)})),h.ipcMain.handle("start-download",(function(e,t,n){g.webContents.downloadURL(t),x=n})),g.webContents.session.on("will-download",(function(e,t,n){x&&(t.setSavePath(x),t.on("updated",(function(e,n){"interrupted"===n?g.webContents.send("download","interrupted"):"progressing"===n&&(t.isPaused()?g.webContents.send("download","paused"):g.webContents.send("download","downloading",t.getReceivedBytes()/t.getTotalBytes()))})),t.once("done",(function(e,t){"completed"===t?g.webContents.send("download","completed"):g.webContents.send("download","failed",t)})),x=null)})),h.ipcMain.handle("app",(function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];switch(t){case"isPackaged":return h.app.isPackaged;case"getPath":return h.app.getPath.apply(h.app,r);case"getAppPath":return h.app.getAppPath();case"getName":return h.app.getName();case"getVersion":return h.app.getVersion();case"setLoginItemSettings":return h.app.setLoginItemSettings.apply(h.app,r);case"relaunch":return h.app.relaunch();case"exit":return h.app.exit.apply(h.app,r);case"quit":return h.app.quit()}})),h.ipcMain.handle("window",(function(e,t){for(var n,r,o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];switch(t){case"close":return g.close();case"minimize":return g.minimize();case"maximize":return g.maximize();case"unmaximize":return g.unmaximize();case"setAlwaysOnTop":return(n=g).setAlwaysOnTop.apply(n,i);case"isVisible":return g.isVisible();case"isMaximized":return g.isMaximized();case"setFullScreen":return(r=g).setFullScreen.apply(r,i);case"reload":return g.reload()}})),g.on("hide",(function(){g.webContents.send("window-event","hide")})),g.on("show",(function(){"darwin"===process.platform&&h.app.dock.show(),g.webContents.send("window-event","show")})),g.on("close",(function(e){if(h.app.isQuiting)h.globalShortcut.unregisterAll(),h.app.exit();else{if(e.preventDefault(),"darwin"===process.platform&&g.isFullScreen())return void g.setFullScreen(!1);g.webContents.send("window-event","close"),v?(g.blur(),g.hide(),"darwin"===process.platform&&h.app.dock.hide()):g.minimize()}return!1})),g.on("maximize",(function(e){g.webContents.send("window-event","maximize")})),g.on("unmaximize",(function(e){g.webContents.send("window-event","unmaximize")})),g.on("enter-full-screen",(function(e){g.webContents.send("window-event","enter-full-screen")})),g.on("leave-full-screen",(function(e){g.webContents.send("window-event","leave-full-screen")})),g.on("session-end",(function(e){e.preventDefault(),g.webContents.send("app-exit")})),h.ipcMain.handle("webContent",(function(e,t){if("toggleDevTools"===t)return g.webContents.toggleDevTools()})),h.ipcMain.handle("dialog",(r=l()(p().mark((function e(t,n){var r,o,i,a=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=a.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=a[i];e.t0=n,e.next="showMessageBox"===e.t0?4:"showOpenDialogSync"===e.t0?7:8;break;case 4:return e.next=6,h.dialog.showMessageBox.apply(h.dialog,[g].concat(o));case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return",h.dialog.showOpenDialogSync.apply(h.dialog,[g].concat(o)));case 8:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})),h.ipcMain.handle("globalShortcut",(function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];switch(t){case"register":return h.globalShortcut.register(r[0],(function(){g.webContents.send("shortcut-pressed",r[0])}));case"unregister":return h.globalShortcut.unregister.apply(h.globalShortcut,r);case"isRegistered":return h.globalShortcut.isRegistered.apply(h.globalShortcut,r)}})),h.ipcMain.handle("nativeTheme",(function(e,t){if("shouldUseDarkColors"===t)return h.nativeTheme.shouldUseDarkColors})),h.nativeTheme.on("updated",(function(){g.webContents.send("native-theme-updated",h.nativeTheme.shouldUseDarkColors)})),h.ipcMain.handle("powerSaveBlocker",(function(e,t){for(var n,r,o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];switch(t){case"start":return(n=powerSaveBlocker).start.apply(n,i);case"stop":return(r=powerSaveBlocker).stop.apply(r,i)}})),h.ipcMain.on("set-allow-unsafe-urls",(function(e,t){I=t})),g.setTouchBar(new k({items:[new C({label:"General",backgroundColor:"#505050",click:function(){g.webContents.send("menu-item-change","general")}}),new C({label:"Proxies",backgroundColor:"#505050",click:function(){g.webContents.send("menu-item-change","proxy")}}),new C({label:"Profiles",backgroundColor:"#505050",click:function(){g.webContents.send("menu-item-change","server")}}),new C({label:"Logs",backgroundColor:"#505050",click:function(){g.webContents.send("menu-item-change","log")}}),new C({label:"连接",backgroundColor:"#505050",click:function(){g.webContents.send("menu-item-change","connection")}}),new C({label:"Settings",backgroundColor:"#505050",click:function(){g.webContents.send("menu-item-change","setting")}}),new C({label:"Feedback",backgroundColor:"#505050",click:function(){g.webContents.send("menu-item-change","about")}})]})),h.powerMonitor.on("suspend",(function(){g.webContents.send("power-event","suspend")})),h.powerMonitor.on("resume",(function(){g.webContents.send("power-event","resume")})),h.ipcMain.handle("window-control",(function(e,t){switch(t){case"hide":h.app.quit();break;case"show":L();break;case"show-or-hide":g.isVisible()&&g.isFocused()?h.app.quit():L()}})),h.ipcMain.on("cleanup-done",(function(e){h.app.isQuiting=!0,h.app.quit()})),h.ipcMain.on("status-changed",(function(e,t){try{"darwin"!==process.platform&&v.setImage(t)}catch(e){}})),h.ipcMain.on("show-notification",(function(e,t){var n=M.join(global.__static,"imgs/logo_64.png"),r=new h.Notification(b(b({},t),{},{icon:"darwin"!==process.platform?h.nativeImage.createFromPath(n):null})),o=t.folder,i=t.url;o&&r.on("click",(function(){h.shell.openPath(t.folder)})),i&&r.on("click",(function(){h.shell.openExternal(i)})),r.show()})),h.ipcMain.on("clash-core-info",(function(e,t){var n=t.port,r=t.secret;n>0&&(P=f().create({baseURL:"http://127.0.0.1:".concat(n,"/"),timeout:5e3,headers:{Authorization:"Bearer ".concat(r)}}))}));var o,a={systemProxyChecked:!1,tunModeChecked:!1,mixinChecked:!1,isReady:!1,menuMode:"",menuStyle:0,isShowDelayIcon:!1},s=function(e){return h.nativeImage.createFromPath(M.join(__static,"imgs","tray-proxy-".concat(e,".png"))).resize({width:8,height:8})},u=(s("default"),s("online")),d=s("offline"),m=(o=l()(p().mark((function e(){var n,r,o,c,s,l,f,m,b,y,w,v;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],e.prev=1,j()&&2!==!a.menuStyle){e.next=12;break}return e.next=5,Promise.all([P.get("/proxies"),P.get("/providers/proxies")]);case 5:r=e.sent,o=i()(r,2),c=o[0],s=o[1],l=(null==c?void 0:c.data)||{},f=l.proxies,m=(null==s?void 0:s.data)||{},b=m.providers,f&&((y=Object.entries(f).reduce((function(e,n){var r=i()(n,2),o=r[0],a=r[1];return"Selector"===(a||{}).type?[].concat(t()(e),[{name:o,all:a.all,now:a.now}]):e}),[])).sort((function(e,t){var n=f.GLOBAL.all;return n.findIndex((function(t){return t===e.name}))-n.findIndex((function(e){return e===t.name}))})),w=Object.entries(b).reduce((function(e,n){var r=i()(n,2),o=(r[0],(r[1]||{}).proxies),a=void 0===o?[]:o;return[].concat(t()(e),t()(a))})),n=y.map((function(e){var t=e.name,n=e.all,r=e.now;return{label:t,submenu:n.map((function(e){var n=w.find((function(t){return t.name===e}))||[];return{label:e,type:"radio",checked:e===r,icon:a.isShowDelayIcon?n.alive?u:d:null,click:function(){P&&P.put("/proxies/".concat(encodeURIComponent(t)),{name:e}).then((function(e){204===e.status&&(g.webContents.send("persist-selected-proxy"),g.webContents.send("break-connections",t))})).catch((function(e){}))}}}))}})));case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(1);case 16:return v=[[{label:"代理组",enabled:!1}].concat(t()(n)),[{label:"代理组",submenu:n}],[]][a.menuStyle||0],e.abrupt("return",[{label:"仪表盘",click:L},{label:"运行任务栏脚本",visible:"linux"!==process.platform,click:function(){return g.webContents.send("run-tray-script")}},{type:"separator"},{label:"&系统代理",type:"checkbox",id:"system-proxy",checked:a.systemProxyChecked,enabled:a.isReady,visible:"linux"!==process.platform,click:function(e){var t=e.checked;g.webContents.send("system-proxy-changed",t)}},{label:"TUN 模式",type:"checkbox",id:"tun",enabled:a.isReady,checked:a.tunModeChecked,click:function(e){var t=e.checked;g.webContents.send("tun-changed",t)}},{label:"混合配置",type:"checkbox",id:"mixin",enabled:a.isReady,checked:a.mixinChecked,click:function(e){var t=e.checked;g.webContents.send("mixin-changed",t)}},{type:"separator"},{label:"代理模式",id:"mode",enabled:!1},{label:"全局",type:"radio",id:"mode-global",enabled:a.isReady,checked:"global"===a.menuMode,click:function(){return g.webContents.send("mode-changed","global")}},{label:"规则",type:"radio",id:"mode-rule",enabled:a.isReady,checked:"rule"===a.menuMode,click:function(){return g.webContents.send("mode-changed","rule")}},{label:"直连",type:"radio",id:"mode-direct",enabled:a.isReady,checked:"direct"===a.menuMode,click:function(){return g.webContents.send("mode-changed","direct")}},{label:"脚本",type:"radio",id:"mode-script",enabled:a.isReady,checked:"script"===a.menuMode,click:function(){return g.webContents.send("mode-changed","script")}},{type:"separator"}].concat(t()(v),[{type:"separator"},{label:"连接",id:"connection",enabled:!1},{label:"关闭全部",type:"normal",enabled:a.isReady,click:function(){P.delete("/connections")}},{type:"separator"},{label:"更多",submenu:[{label:"切换Dev工具",click:function(){g.webContents.toggleDevTools()}},{label:"将仪表板移至最近的显示器",click:function(){g.setBounds(B(g.getBounds())),L()}},{label:"重启",click:function(){h.app.relaunch(),h.app.exit(0)}},{label:"强制退出",click:function(){h.app.isQuiting=!0,h.app.quit()}}]},{type:"separator"},{label:"退出",click:function(){return g.webContents.send("app-exit")}}]));case 18:case"end":return e.stop()}}),e,null,[[1,14]])}))),function(){return o.apply(this,arguments)}),S=function(){var e;if(!v){var t=h.nativeImage.createFromPath(M.join(__static,"imgs","logo_64_eyes.png")).resize({width:24,height:24});t.setTemplateImage(!0);var n=M.join(__static,"tray","win","tray_normal.ico"),r=M.join(__static,"imgs","logo_reverse_32.png"),o=(e={},c()(e,"win32",n),c()(e,"darwin",t),c()(e,"linux",r),e)[process.platform];(v=new h.Tray(o)).setToolTip("Clash for Windows"),v.on("right-click",(function(){m().then((function(e){v.popUpContextMenu(h.Menu.buildFromTemplate(e))}))})),v.on("click",(function(){"darwin"!==process.platform&&L()})),v.on("mouse-down",L)}};S(),h.ipcMain.handle("tray-create-destroy",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"create";"create"===t&&S(),"destroy"===t&&v&&(v.destroy(),v=null)}));var O=h.Menu.buildFromTemplate([{label:"仪表盘",click:L},{type:"separator"},{label:"TUN 模式",type:"checkbox",id:"tun",enabled:!1,click:function(e){var t=e.checked;g.webContents.send("tun-changed",t)}},{label:"混合配置",type:"checkbox",id:"mixin",enabled:!1,click:function(e){var t=e.checked;g.webContents.send("mixin-changed",t)}},{type:"separator"},{label:"代理模式",id:"mode",enabled:!1},{label:"全局",type:"radio",id:"mode-global",enabled:!1,click:function(){return g.webContents.send("mode-changed","global")}},{label:"规则",type:"radio",id:"mode-rule",enabled:a.isReady,checked:"rule"===a.menuMode,click:function(){return g.webContents.send("mode-changed","rule")}},{label:"直连",type:"radio",id:"mode-direct",enabled:!1,click:function(){return g.webContents.send("mode-changed","direct")}},{label:"脚本",type:"radio",id:"mode-script",enabled:!1,click:function(){return g.webContents.send("mode-changed","script")}},{type:"separator"},{label:"更多",submenu:[{label:"切换Dev工具",click:function(){g.webContents.toggleDevTools()}},{label:"将仪表板移至最近的显示器",click:function(){g.setBounds(B(g.getBounds())),L()}},{label:"重启",click:function(){h.app.relaunch(),h.app.exit(0)}},{label:"强制退出",click:function(){h.app.isQuiting=!0,h.app.quit()}}]},{type:"separator"},{label:"退出",click:function(){return g.webContents.send("app-exit")}}]);function D(){j()&&v&&v.setContextMenu(O)}D(),h.ipcMain.on("clash-core-status-change",(function(e,t){if(a.isReady=!0,j()){var n=O.getMenuItemById("system-proxy");n&&(n.enabled=1!==t);var r=O.getMenuItemById("mixin");r&&(r.enabled=1!==t);var o=O.getMenuItemById("tun");o&&(o.enabled=1!==t),["global","rule","direct","script"].forEach((function(e){var n=O.getMenuItemById("mode-".concat(e));n&&(n.enabled=1!==t)})),D()}})),h.ipcMain.handle("tray-proxies-style",(function(e,t){a.menuStyle=t})),h.ipcMain.handle("tray-proxies-icon",(function(e,t){a.isShowDelayIcon=t})),h.ipcMain.on("mode-changed",(function(e,t){if(a.menuMode=t,j()){var n="mode-".concat(t),r=O.getMenuItemById(n);r&&(r.checked=!0),D()}})),h.ipcMain.on("system-proxy-changed",(function(e,t){a.systemProxyChecked=t})),h.ipcMain.on("mixin-changed",(function(e,t){if(a.mixinChecked=t,j()){var n=O.getMenuItemById("mixin");n&&(n.checked=t),D()}})),h.ipcMain.on("tun-changed",(function(e,t){if(a.tunModeChecked=t,j()){var n=O.getMenuItemById("tun");n&&(n.checked=t),D()}})),h.ipcMain.on("enhanced-tray-click",L),h.ipcMain.on("speed-update",(function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#fff";try{if(v){var o=h.nativeImage.createFromDataURL(t);if("win32"===process.platform){if(60===n)return void(y&&(y.destroy(),y=null,w=0));var i=o.crop({x:0,y:0,width:n+8,height:69}),a=M.join(h.app.getPath("temp"),"cfw-sub.html"),c=i.getSize(),s=c.width,l=c.height;_.writeFileSync(a,'\n          <body style="position:relative;background-color:'.concat(r,';overflow:hidden;-webkit-app-region:drag;margin:0;width:100%;height:100%;box-sizing:border-box;">\n            <img id="img" style="height:100%;width:100%;" src="').concat(i.toDataURL(),'" />\n            <div style="position:absolute;width:50%;height:100%;top:0;left:50%;-webkit-app-region:no-drag;" onclick="handleClick()"></div>\n          </body>\n          <script>\n            const { ipcRenderer } = require(\'electron\');\n            ipcRenderer.on(\'speed-update-win\', (e, url, bgc) => {\n              document.getElementById("img").src = url;\n              document.body.style.backgroundColor = bgc;\n            })\n            const handleClick = () => {\n              ipcRenderer.send(\'enhanced-tray-click\');\n            }\n          <\/script>\n          ')),y||(y=new h.BrowserWindow({show:!0,alwaysOnTop:!0,closable:!1,focusable:!1,frame:!1,useContentSize:!0,maximizable:!1,transparent:!0,minimizable:!1,resizable:!1,webPreferences:{nodeIntegration:!0,contextIsolation:!1}})).loadFile(a),y.show(),y.webContents.send("speed-update-win",i.toDataURL(),r),w!==n&&y.setBounds({height:Math.ceil(l/2.8),width:Math.ceil(s/2.8)}),w=n}if("darwin"===process.platform){var u=(""===t?h.nativeImage.createFromPath(M.join(__static,"imgs","logo_64_eyes.png")):o.crop({x:0,y:0,width:n,height:69})).resize({height:23});u.setTemplateImage(!0),v.setImage(u)}}}catch(e){}}));var E,z,F=[{label:h.app.name,submenu:[{role:"about"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideothers"},{role:"unhide"},{label:"Close",accelerator:"Command+W",click:function(){}},{type:"separator"},{label:"退出 Clash for Windows",accelerator:"Command+Q",click:function(){g.webContents.send("app-exit")}}]},{role:"editMenu"},{label:"View",submenu:[{role:"reload"},{role:"forceReload"},{role:"toggleDevTools"},{type:"separator"},{role:"resetZoom"},{role:"zoomIn",accelerator:"CmdOrCtrl+="},{role:"zoomOut"},{type:"separator"},{role:"togglefullscreen"}]},{role:"windowMenu"},{role:"help",submenu:[{label:"Github",click:(z=l()(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n(298),r=t.shell,e.next=3,r.openExternal("https://github.com/Fndroid/clash_for_windows_pkg");case 3:case"end":return e.stop()}}),e)}))),function(){return z.apply(this,arguments)})},{label:"Document",click:(E=l()(p().mark((function e(){var t,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n(298),r=t.shell,e.next=3,r.openExternal("https://docs.cfw.lbyczf.com/");case 3:case"end":return e.stop()}}),e)}))),function(){return E.apply(this,arguments)})}]}];h.Menu.setApplicationMenu(h.Menu.buildFromTemplate(F)),h.ipcMain.handle("wlan-status-wanted",R)}function R(){if(g)try{n(354).addEventListener("wlan-status-changed",(function(e,t){e?g.webContents.send("wlan-status-listen-error",JSON.stringify(e)):g.webContents.send("wlan-status-changed",t)}))}catch(e){g.webContents.send("wlan-status-listen-error",e.message)}}function A(){h.app.relaunch(),h.app.exit(0)}var E,z=h.app.requestSingleInstanceLock();function B(e){var t=e.x,n=e.y,r=h.screen.getAllDisplays().find((function(e){var r=e.bounds;if(r){var o=r.x,i=r.y,a=r.width,c=r.height;return S.inRange(t,o,o+a)&&S.inRange(n,i,i+c)}}));if(!r){var o=h.screen.getDisplayNearestPoint({x:t,y:n}).bounds;if(o)return{x:o.x,y:o.y}}return{x:t,y:n}}h.app.setAppUserModelId("com.lbyczf.clashwin"),h.app.setAsDefaultProtocolClient("clash"),h.app.setName("Clash for Windows"),h.app.setAboutPanelOptions({version:""}),h.app.on("open-url",(function(e,t){g.webContents.send("app-open",[t])})),z?(h.app.on("second-instance",(function(e,t,n){g&&(g.webContents.send("app-open",t),g.isMinimized()&&g.restore(),L())})),h.app.on("ready",(function(){n(113).init(),h.powerMonitor.on("shutdown",(function(e){e.preventDefault(),g.webContents.send("app-exit"),setTimeout((function(){h.app.isQuiting=!0,h.app.quit()}),5e3)})),D()}))):h.app.quit(),h.app.on("activate",(function(){null===g?D():L()})),h.app.on("certificate-error",(E=l()(p().mark((function e(t,n,r,o,i,a){var c,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=fales;try{s=new URL(r),c="raw.githubusercontent.com"===s.host&&"/Fndroid/ads/master/ads_v2.json"===s.path}catch(e){}if(!c&&!I.includes(r)){e.next=7;break}t.preventDefault(),a(!0),e.next=13;break;case 7:return e.next=9,h.dialog.showMessageBox({type:"warning",buttons:["Trust","Cancel"],title:"Certificate Error",message:"Failed verify the certificate for ".concat(r,". This may be because the certificate is self-signed or the certificate authority is not recognized. Do you want to trust this certificate?")});case 9:0===e.sent.response&&h.dialog.showCertificateTrustDialog(g,{certificate:i,message:"If you keep seeing this error, you need to go to Keychain APP to trust the certificate."}).catch((function(e){console.error(e)})),a(!1);case 13:case"end":return e.stop()}}),e)}))),function(e,t,n,r,o,i){return E.apply(this,arguments)}))})(),module.exports=r})();